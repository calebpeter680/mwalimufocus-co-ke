{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXNCD5KZR9" defer></script>
    <script>
      function initializeGA() {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXNCD5KZR9', {
          'transport_type': 'beacon'
        });
      }
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex">
    <title>Generated Exam/Assignment Preview * MwalimuFocus.Co.Ke</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-icons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="icon" href="{% static 'img/favicon-32x32.png' %}" sizes="32x32" type="image/png">
    <link rel="icon" href="{% static 'img/favicon-16x16.png' %}" sizes="16x16" type="image/png">


    <style>
        .pdf-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10; 
        }

        .alert {
            margin: 0; 
        }
    </style>



  </head>
  <body class="bg-body-tertiary">
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <symbol id="bi-journal-code" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8.646 5.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 8 8.646 6.354a.5.5 0 0 1 0-.708m-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 8l1.647-1.646a.5.5 0 0 0 0-.708"/>
        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2"/>
        <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1z"/>
      </symbol>
    </svg>

    <nav class="navbar navbar-expand-lg navbar-light bg-light text-center" style="padding-top: 0.1rem; padding-bottom: 0.1rem;">
      <div class="container-fluid">
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0 flex-lg-row"> <!-- Remove 'flex-column' class -->
                <li class="nav-item">
                    <a class="nav-link" href="tel:{{ brand.phone_number }}" style="font-size: 0.9rem;">
                        <i class="bi bi-telephone"></i> {{ brand.phone_number }}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="mailto:{{ brand.email }}" style="font-size: 0.9rem;">
                        <i class="bi bi-envelope"></i> {{ brand.email }}
                    </a>
                </li>
              </ul>
          </div>
      </div>
    </nav>



    <nav class="navbar sticky-top navbar-expand-lg navbar-light" style="background: {{ brand.primary_color }};">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <img src="{% static 'img/logo.webp' %}" alt="MwalimuFocus.Co.Ke" height="70" width="170" loading="lazy">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent1" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">

          <span class="navbar-toggler-icon"></span>

        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent1">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/">Home</a>
            </li>
            {% for item in menu_items %}
            <li class="nav-item">
              <a class="nav-link" href="/categories/{{ item.slug }}">{{ item.name }}</a>
            </li>
            {% endfor %}
          </ul>

          <ul class="navbar-nav">
            {% if user.is_authenticated %}
                <li>
                  <div class="dropdown">
                    <button class="btn btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                      <i class="bi bi-person-circle"></i> My Profile
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-lg-start">
                      <li><a class="dropdown-item" href="/accounts/dashboard/">Dashboard</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
                    </ul>
                  </div>
                </li>
            {% else %}
                <li>
                    <button class="btn btn-dark" data-bs-target="#accountModal" data-bs-toggle="modal">My Account</button>
                </li>
            {% endif %}
          </ul>

        </div>
      </div>
    </nav>

    <!-- Start of Container -->
    <div class="container my-5">

      {% if generated_exam and marking_scheme %}
      <h1 class="mt-4 mb-2" style="font-size: 20px;"><i class="bi bi-check-circle-fill"></i> Generated Successfully!</h1>

      <div class="d-flex">
          <p class="mb-0 me-3" style="font-size: 12px;">
              <i class="bi bi-shield-check"></i> 100% original
          </p>
          <p class="mb-0" style="font-size: 12px;">
              <i class="bi bi-cloud-download"></i> Instant download after payment
          </p>
      </div>

      <button id="previewBtn" class="btn btn-dark btn-sm mt-2 d-block d-sm-none d-md-none"><i class="bi bi-eye"></i> See Preview</button>


      {% else %}
      <h1 class="mt-4 mb-2" style="font-size: 24px;"><i class="bi bi-arrow-clockwise"></i> Generation in Progress!</h1>
      {% endif %}

      <div class="row">
        <div id="preview_section" class="col-md-8 order-2 order-md-1">
          <h2 class="text-left mt-4 mb-2" style="font-size: 18px;"><strong>Previews</strong></h2>
          {% if generated_exam and marking_scheme %}
          <div class="card text-center">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="true" data-bs-toggle="tab" href="#examPreview"><b>{{ generated_exam.assessment_type }}</b></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#markingSchemePreview"><b>Marking Scheme</b></a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                  <!-- Exam Preview Tab -->
                  <div id="examPreview" class="tab-pane fade show active">
                      {% if generated_exam.file %}
                          <div>
                              <button class="btn btn-dark btn-sm" id="prev-exam" style="margin-right: 10px;">< Previous</button>
                              <button class="btn btn-dark btn-sm" id="next-exam">Next ></button>
                              &nbsp; &nbsp;
                              <span>Page: <span id="page_num_exam"></span> / <span id="page_count_exam"></span></span>
                          </div>
                          <hr>
                          <div class="pdf-container" style="position: relative; width: 100%; height: 100%;">
                              <canvas id="pdf-canvas-exam" style="width:100%; height:100%;"></canvas>
                              <div id="overlay-exam" class="overlay" style="display: none;">
                                  <div id="main_exam_pay_preview" class="alert btn btn-dark alert-dark" role="alert">
                                      Pay & Download to View
                                  </div>
                              </div>
                          </div>
                      {% else %}
                          <p>No preview available.</p>
                      {% endif %}
                  </div>

                  <!-- Marking Scheme Preview Tab -->
                  <div id="markingSchemePreview" class="tab-pane fade">
                      {% if marking_scheme and marking_scheme.file %}
                          <div>
                              <button class="btn btn-dark btn-sm" id="prev-marking" style="margin-right: 10px;">< Previous</button>
                              <button class="btn btn-dark btn-sm" id="next-marking">Next ></button>
                              &nbsp; &nbsp;
                              <span>Page: <span id="page_num_marking"></span> / <span id="page_count_marking"></span></span>
                          </div>
                          <hr>
                          <div class="pdf-container" style="position: relative; width: 100%; height: 100%;">
                              <canvas id="pdf-canvas-marking" style="width:100%; height:100%;"></canvas>
                              <div id="overlay-marking" class="overlay" style="display: none;">
                                  <div id="ms_pay_preview" class="btn btn-dark alert alert-dark" role="alert">
                                      Pay and Download to View Content
                                  </div>
                              </div>
                          </div>
                      {% else %}
                          <p>No preview available.</p>
                      {% endif %}
                  </div>
              </div>


            </div>
        </div>


        {% else %}

          <div class="card text-center">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="true" data-bs-toggle="tab" href="#examPreview"><b>Exam/Assignment</b></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#markingSchemePreview"><b>Marking Scheme</b></a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Exam Preview Tab -->
                    <div id="examPreview" class="tab-pane fade show active">
                        {% if generated_exam.file %}
                            <canvas id="generated_exam_canvas" style="width:100%; height:100%;"></canvas>
                        {% else %}
                            <p>No preview available.</p>
                        {% endif %}
                    </div>

                    <!-- Marking Scheme Preview Tab -->
                    <div id="markingSchemePreview" class="tab-pane fade">
                        {% if marking_scheme and marking_scheme.file %}
                            <canvas id="marking_scheme_canvas" style="width:100%; height:100%;"></canvas>
                        {% else %}
                            <p>No preview available.</p>
                        {% endif %}
                    </div>
                </div>

            </div>
          </div>

        {% endif %}

        </div>



        <div id="payment_position" class="col-md-4 order-1 order-md-2">
          <h2 class="text-left mt-4 mb-3" style="font-size: 18px;"><strong>Pay Ksh {{ generated_exam.price }} to Download PDF</strong></h2>
          <p>Enter your details below to initiate a payment using MPESA.</p>
          <div class="card p-4"> 
            <form id="paymentForm">
              {% csrf_token %}
              <div class="form-group mb-4 mt-2">
                  <label for="phonenumber">Your MPESA Phone Number:</label>
                  <input type="text" class="form-control" name="phonenumber" id="phonenumber" placeholder="Phone e.g., 0712345678" required>
                  <div class="invalid-feedback">Please fill out this field.</div>
                  <div class="valid-feedback">Looks good!</div>
                  {% if request.user.is_authenticated %}
                    <div class="form-text">Attachments can be downloaded immediately after purchase, and a copy will also be sent to <strong>{{ request.user.email }}</strong>.</div>
                  {% endif %}
              </div>

              {% if request.user.is_authenticated %}
              <div class="form-group mt-4 mb-4 d-none"> 
                  <label for="email" >Your Email Address:</label>
                  <input type="hidden" class="form-control" name="email" id="email" value="{{ request.user.email }}">
              </div>
              {% else %}
              <div class="form-group mt-4 mb-4"> 
                  <label for="email" >Your Email Address:</label>
                  <input type="text" class="form-control" name="email" id="email" placeholder="Enter your email address...">
                  <div class="form-text">Attachments can be downloaded immediately after purchase, and a copy will also be sent to your provided email.</div>
              </div>
              {% endif %}

              <input type="hidden" id="orderTotal" value="{{ order.total_price }}">
              <input type="hidden" id="orderID" value="{{ order.id }}">


              <span id="phoneNumberError" class="text-danger d-none"></span>

              <div class="text-left justify-content-right">
                  <button id="proceedBtn" type="submit" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#paymentStatus"><i class="bi bi-lock"></i> Proceed to Secure Payment</button>
              </div>
            </form>



            <div class="modal fade" id="paymentStatus" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                      <div class="modal-header modal-payment-status-header">
                          <h1 class="modal-title fs-5 d-flex align-items-center" id="paymentStatusHeader" style="font-size: 34px;">
                            Payment Has Started...
                          </h1>

                          <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>
                      </div>
                      <div class="modal-body">
                          <div id="paymentStatusMessage" class="text-center ms-2">A prompt has been sent to your phone to enter Mpesa PIN.</div>
                      </div>
                  </div>
              </div>
            </div>


          </div>

        </div>
      </div>
    </div>
    <!-- End of Container -->


    <div class="container">
      <footer class="py-5">
        <div class="row">
          <div class="col-12 col-md-3 mb-3">
            <h5>Quick Links</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="/categories/" style="text-decoration: none; color: blue;">All Categories</a>
              </li>
              {% for item in categories_with_items %}
              <li class="nav-item mb-2">
                <a href="/categories/{{ item.slug }}/" style="text-decoration: none; color: blue;">{{ item.name }}</a>
              </li>
              {% endfor %}
            </ul>
          </div>


          <div class="col-12 col-md-3 mb-3">
            <h5>Contact Us</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2"><a href="tel:{{ brand.phone_number }}" class="nav-link p-0 text-body-secondary"><i class="bi bi-telephone"></i> {{ brand.phone_number }}</a></li>
              <li class="nav-item mb-2"><a href="mailto:{{ brand.email }}" class="nav-link p-0 text-body-secondary email-link"><i class="bi bi-envelope"></i> {{ brand.email }}</a></li>
            </ul>
            <h5>Programs & Apps</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2"><a href="{% url 'exam_generator_form' %}" style="text-decoration: none; color: blue;">Exam Generator</a></li>
            </ul>
          </div>

          <div class="col-md-5 offset-md-1 mb-3 subscriber-creation-div">
            <h5>Subscribe to our newsletter</h5>
            <p>Monthly digest of what's new and exciting from us.</p>
            <div class="input-group">
                <input id="newsletterEmail" type="text" class="form-control" placeholder="Email address">
                <button id="subscribeButton" class="btn btn-dark">Subscribe</button>
            </div>
            <div id="subscriptionMessageContainer" class="mt-2"></div>
          </div>
        </div>

        <div class="d-flex flex-column flex-sm-row justify-content-between py-4 my-4 border-top">
          <div class="container">
            <div class="row">
                <div class="col">
                    <p>&copy; 2024 MwalimuFocus.Co.Ke. All rights reserved.</p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p>MwalimuFocus.Co.Ke collaborates with professional teachers across Kenya to outsource high-quality schemes of work, lesson plans, lesson notes, revision booklets, and past papers with marking schemes. Kenyan teachers, parents, and students can download these materials from our website for FREE or at a small fee. Learn more <a href="/about-us/" style="text-decoration: none; color: blue;">about us.</a></p>
                </div>
            </div>
            <div class="row">
              <div class="col-lg-1 col-md-6 col-sm-6">
                  <p><a href="/terms-and-conditions/" style="text-decoration: none; color: blue;">Terms</a></p>
              </div>
              <div class="col-lg-1 col-md-6 col-sm-6">
                  <p><a href="/privacy-policy/" style="text-decoration: none; color: blue;">Privacy</a></p>
              </div>
            </div>
          </div>

          {% if latest_link %}
          <ul class="list-unstyled d-flex">
              {% if latest_link.facebook_url %}
                  <li class="ms-3" style="font-size: 20px;">
                      <a class="link-body-emphasis" href="{{ latest_link.facebook_url }}" target="_blank">
                          <i class="bi bi-facebook"></i>
                      </a>
                  </li>
              {% endif %}
              {% if latest_link.telegram_url %}
                  <li class="ms-3" style="font-size: 20px;">
                      <a class="link-body-emphasis" href="{{ latest_link.telegram_url }}" target="_blank">
                          <i class="bi bi-telegram"></i>
                      </a>
                  </li>
              {% endif %}
              {% if latest_link.whatsapp_url %}
                  <li class="ms-3" style="font-size: 20px;">
                      <a class="link-body-emphasis" href="{{ latest_link.whatsapp_url }}" target="_blank">
                          <i class="bi bi-whatsapp"></i>
                      </a>
                  </li>
              {% endif %}
          </ul>
          {% endif %}
        </div>
      </footer>
    </div>



   









    <!-- First Modal - Account Activity Selection -->
    <div class="modal fade" id="accountModal" aria-hidden="true" aria-labelledby="accountModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <p class="modal-title" id="accountModalLabel" style="font-size: 24px;">I want to:</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="btn btn-dark" data-bs-target="#registerModal" data-bs-toggle="modal" data-bs-dismiss="modal">Register</button>
                    <button class="btn btn-dark" data-bs-target="#loginModal" data-bs-toggle="modal" data-bs-dismiss="modal">Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Second Modal - Register or Login -->
    <div class="modal fade" id="registerModal" aria-hidden="true" aria-labelledby="registerModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="registerModalLabel" style="font-size: 24px;">Register as:</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="btn btn-dark" data-bs-target="#customerRegisterModal" data-bs-toggle="modal" data-bs-dismiss="modal">Customer</button>
                    <button class="btn btn-dark" data-bs-target="#vendorRegisterModal" data-bs-toggle="modal" data-bs-dismiss="modal">Vendor</button>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-outline-dark" data-bs-target="#accountModal" data-bs-toggle="modal">Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Third Modal - Customer Registration Form -->
    <div class="modal fade" id="customerRegisterModal" aria-hidden="true" aria-labelledby="customerRegisterModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="customerRegisterModalLabel" style="font-size: 24px;">Customer Registration</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body customer_registration_modal">
                    <form id="customerRegistrationForm" method="post">
                      {% csrf_token %}
                      <div class="mb-3">
                          <label for="emailInput1" class="form-label">Email Address (required)</label>
                          <input type="email" class="form-control" id="emailInput1" name="email" required>
                      </div>
                      <div class="mb-3">
                          <label for="passwordInput1" class="form-label">Password (required)</label>
                          <input type="password" class="form-control" id="passwordInput1" name="password" required>
                      </div>
                      <div class="mb-3">
                          <label for="phoneNumberInput1" class="form-label">Phone Number (optional)</label>
                          <input type="tel" class="form-control" id="phoneNumberInput1" name="phone_number">
                      </div>
                      <div class="mb-3 form-check">
                          <input type="checkbox" class="form-check-input" id="agreeTermsInput1" name="agree_to_terms" checked>
                          <label class="form-check-label" for="agreeTermsInput1">Agree to Terms</label>
                      </div>
                      <input type="hidden" name="is_vendor" value="False">

                      <button type="submit" class="btn btn-dark" id="registerCustomerBtn">Register</button>
                    </form>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-outline-dark" data-bs-target="#registerModal" data-bs-toggle="modal">Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fourth Modal - Vendor Registration Form -->
    <div class="modal fade" id="vendorRegisterModal" aria-hidden="true" aria-labelledby="vendorRegisterModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="vendorRegisterModalLabel" style="font-size: 24px;">Vendor Registration</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="vendor-registration-modal modal-body">
                  <form id="registrationForm" method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="emailInput" class="form-label">Email Address (required)</label>
                        <input type="email" class="form-control" id="emailInput" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="passwordInput" class="form-label">Password (required)</label>
                        <input type="password" class="form-control" id="passwordInput" name="password" required>
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumberInput" class="form-label">Phone Number (optional)</label>
                        <input type="tel" class="form-control" id="phoneNumberInput" name="phone_number">
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="agreeTermsInput" name="agree_to_terms" checked>
                        <label class="form-check-label" for="agreeTermsInput">Agree to Terms</label>
                    </div>
                    <input type="hidden" name="is_vendor" value="True">

                    <button type="submit" class="btn btn-dark" id="registerBtn">Register</button>
                  </form>
                </div>

                <div class="modal-footer">
                  <button class="btn btn-outline-dark" data-bs-target="#registerModal" data-bs-toggle="modal">Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generation Progress Modal -->
    <div class="modal fade" id="progressModal" tabindex="-1" aria-labelledby="progressModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
              The Generation Process is Finalizing...
          </div>
          <div class="modal-body">
              <div class="progress" role="progressbar" aria-label="Animated striped example" aria-valuenow="99" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-dark progress-bar-striped progress-bar-animated" style="width: 99%"></div>
              </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Fifth Modal - Login -->
    <div class="modal fade" id="loginModal" aria-hidden="true" aria-labelledby="loginModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="loginModalLabel" style="font-size: 24px;">Login</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body login-modal">
                    <form>
                      <div class="mb-3">
                        <label for="InputEmail2" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="InputEmail2" aria-describedby="emailHelp">
                      </div>
                      <div class="mb-3">
                        <label for="InputPassword2" class="form-label">Password</label>
                        <input type="password" class="form-control" id="InputPassword2">
                      </div>
                      <button type="submit" class="btn btn-dark" id="loginBtn">Submit</button>
                    </form>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <a href="{% url 'reset_password' %}" class="text-decoration-none">Forgot Password</a>
                    <button class="btn btn-outline-dark" data-bs-target="#accountModal" data-bs-toggle="modal">Back</button>
                </div>

            </div>
        </div>
      </div>
    </div>

    <script src="{% static 'js/popper.min.js' %}" defer></script>
    <script src="{% static 'js/bootstrap.min.js' %}" defer></script>
    <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
    <script defer src="{% static 'js/sign_up.js' %}"></script>
    <script defer src="{% static 'js/login.js' %}"></script>
    <script src="{% static 'js/image_url_format.js' %}"></script>
    <script defer src="{% static 'js/newsletter.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="{% static 'js/payment_status.js' %}"></script>
    <script src="{% static 'js/stk.js' %}"></script>


    {% if not generated_exam or not marking_scheme %}
          <script>
            document.addEventListener('DOMContentLoaded', function() {
                var modalElement = document.getElementById('progressModal');
                var myModal = new bootstrap.Modal(modalElement);
                myModal.show();

                var taskId = "{{ task_id }}";
                console.log('Task ID:', taskId); 

                if (!taskId || taskId.trim() === '') {
                    console.log('Task ID is invalid or empty. Redirecting to exam_generator_form.');
                    window.location.href = "{% url 'exam_generator_form' %}";
                    return; 
                }

                var taskStatusUrl = "{% url 'task_status' 'TASK_ID' %}".replace('TASK_ID', taskId);
                console.log('Task Status URL:', taskStatusUrl); 

                function checkTaskStatus() {
                    console.log('Checking task status...');
                    fetch(taskStatusUrl)
                        .then(response => {
                            console.log('Response received:', response); 
                            return response.json();
                        })
                        .then(data => {
                            console.log('Data received:', data); 
                            if (data.status === 'SUCCESS') {
                                console.log('Task status is SUCCESS. Reloading page...');
                                setTimeout(function() {
                                      window.location.href = "{% url 'exam_session_order_detail' %}";
                                  }, 2500);
                                clearInterval(checkInterval); 
                                
                            } else if (data.status === 'FAILURE') {
                                console.log('Task status is FAILURE. Displaying error message and redirecting...');
                                clearInterval(checkInterval);
                                modalElement.querySelector('.modal-body').innerHTML = `
                                    <p>An Error Occurred, Try Again</p>
                                `;
                                setTimeout(function() {
                                    window.location.href = "{% url 'exam_generator_form' %}";
                                }, 2500); 
                            }
                        })
                        .catch(error => {
                            console.error('Error occurred during fetch:', error); 
                            clearInterval(checkInterval); // Stop checking
                            modalElement.querySelector('.modal-body').innerHTML = `
                                <p>An Error Occurred, Try Again</p>
                            `;
                            setTimeout(function() {
                                window.location.href = "{% url 'exam_generator_form' %}";
                            }, 2500);
                        });
                }

                var checkInterval = setInterval(function() {
                    checkTaskStatus();
                }, 1000); 
            });
        </script>

    {% endif %}


        <script>
          function renderPDF(url, canvasId, pageNumId, pageCountId, prevBtnId, nextBtnId, firstPageScale, otherPagesScale) {
            var pdfDoc = null,
                pageNum = 1,
                pageRendering = false,
                pageNumPending = null,
                scale = firstPageScale,
                canvas = document.getElementById(canvasId),
                ctx = canvas.getContext('2d'),
                overlay = document.getElementById(`overlay-${canvasId.split('-')[2]}`);

            function renderPage(num) {
                pageRendering = true;
                pdfDoc.getPage(num).then(function(page) {
                    scale = (num <= 2) ? firstPageScale : otherPagesScale;

                    var viewport = page.getViewport({ scale: scale });
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    var renderContext = {
                        canvasContext: ctx,
                        viewport: viewport
                    };
                    var renderTask = page.render(renderContext);

                    renderTask.promise.then(function() {
                        pageRendering = false;
                        if (pageNumPending !== null) {
                            renderPage(pageNumPending);
                            pageNumPending = null;
                        }
                        if (scale === otherPagesScale) {
                            overlay.style.display = 'flex'; 
                        } else {
                            overlay.style.display = 'none';
                        }
                    });
                });

                document.getElementById(pageNumId).textContent = num;
            }

            function queueRenderPage(num) {
                if (pageRendering) {
                    pageNumPending = num;
                } else {
                    renderPage(num);
                }
            }

            function onPrevPage() {
                if (pageNum <= 1) {
                    return;
                }
                pageNum--;
                queueRenderPage(pageNum);
            }

            function onNextPage() {
                if (pageNum >= pdfDoc.numPages) {
                    return;
                }
                pageNum++;
                queueRenderPage(pageNum);
            }

            document.getElementById(prevBtnId).addEventListener('click', onPrevPage);
            document.getElementById(nextBtnId).addEventListener('click', onNextPage);

            pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById(pageCountId).textContent = pdfDoc.numPages;
                renderPage(pageNum);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            {% if generated_exam.file %}
                renderPDF('{{ generated_exam.file.url }}', 'pdf-canvas-exam', 'page_num_exam', 'page_count_exam', 'prev-exam', 'next-exam', 5.0, 0.2);
            {% endif %}
            {% if marking_scheme and marking_scheme.file %}
                renderPDF('{{ marking_scheme.file.url }}', 'pdf-canvas-marking', 'page_num_marking', 'page_count_marking', 'prev-marking', 'next-marking', 5.0, 0.2);
            {% endif %}
        });

      </script>


      <script>
        function scrollToPaymentPosition() {
            const targetElement = document.getElementById('payment_position');
            
            targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start' 
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const mainExamPayPreview = document.getElementById('main_exam_pay_preview');
            const msPayPreview = document.getElementById('ms_pay_preview');

            if (mainExamPayPreview) {
                mainExamPayPreview.addEventListener('click', scrollToPaymentPosition);
            }

            if (msPayPreview) {
                msPayPreview.addEventListener('click', scrollToPaymentPosition);
            }
        });
    </script>


    <script>
        function scrollToPreviewSection() {
            const targetElement = document.getElementById('preview_section');
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start' 
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const previewBtn = document.getElementById('previewBtn');
            if (previewBtn) {
                previewBtn.addEventListener('click', scrollToPreviewSection);
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded",function(){const paymentStatusModalElement=document.getElementById("paymentStatus");paymentStatusModalElement.addEventListener("show.bs.modal",function(event){const form=document.getElementById("paymentForm");if(!form.checkValidity()){event.preventDefault();form.classList.add("was-validated")}})});function validateForm(event){const form=document.getElementById("paymentForm");const paymentStatusModal=new bootstrap.Modal(document.getElementById("paymentStatus"));if(form.checkValidity()){paymentStatusModal.show()}else{form.classList.add("was-validated")}}
    </script>









  </body>
</html>